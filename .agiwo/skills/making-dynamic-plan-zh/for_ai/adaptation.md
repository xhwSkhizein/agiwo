# 适配：为 AI 自我规划

完成三个核心引擎（诊断 → 结构 → 演进）后，在规划自己的任务执行时应用这些启发式方法。

## 诊断启发式

在自我规划时，你已经有了任务背景。应用这些规则快速分类：

| 任务中的信号 | 不确定性水平 | 策略 |
|------------|-----------|------|
| 单个定义明确的文件更改，清晰的需求 | 低 | 计划驱动：列出步骤，按顺序执行 |
| 多文件更改，部分需求，需要一些研究 | 中 | 价值驱动：首先识别最高影响的工作，迭代 |
| 新领域，方法不清楚，需要在承诺前探索 | 高 | 假设驱动：制定假设，用小探针测试，适应 |

**默认**：如果你在阅读任务后 30 秒内无法分类，将其视为**中等**。

## 粒度规则

| 任务范围 | 计划粒度 |
|---------|---------|
| ≤3 个步骤，单一关注 | 仅心智模型 — 无需书面计划 |
| 4–10 个步骤，中等复杂性 | 阶段级别计划，带有关键里程碑 |
| >10 个步骤，跨越多个关注点，或多会话 | 完整任务图，带有依赖关系和检验点 |

## 自我规划原则

1. **先规划后行动**：对于非平凡的任务，在进行任何更改之前生成计划
2. **一次一个步骤**：同时保持恰好一个任务处于进行中状态
3. **发现后更新**：当新信息到达时（意外错误、新约束、更改的需求），立即更新计划 — 不要继续使用过时的计划
4. **检验点纪律**：完成每个阶段后，暂停并评估：
   - 单回路："此阶段是否产生了预期的输出？"
   - 双回路："鉴于我刚刚学到的内容，剩余计划是否仍然有意义？"
5. **快速失败，早期重新规划**：如果一种方法失败两次，不要重试 — 用新信息重新进入引擎 1

## 缓冲估计

对于计划中的时间/工作量估计：

| 不确定性 | 缓冲倍数 |
|---------|---------|
| 低 | 1.2× （增加约 20% 的松弛） |
| 中 | 1.5× （增加约 50% 的松弛） |
| 高 | 2.0× （将估计加倍，或分成更小的实验） |

实际上：如果你估计一个任务需要 5 个步骤，中等不确定性的计划应该预期最多约 8 个步骤。

## 进度跟踪

使用 todo_list 工具跟踪执行。将计划阶段映射到待办事项：

- 每个阶段 → 一个待办事项
- 开始时标记为 `in_progress`，完成时标记为 `completed`
- 如果一个阶段需要分割，添加子项目，而不是让一个项目无限增长

## 何时跳过规划

并非每个任务都需要正式计划。在以下情况下跳过直接执行：

- 任务是单个、定义明确的操作（例如，重命名变量、修复打字错误）
- 你之前做过这种确切类型的任务，没有惊喜
- 错误的影响范围很小（易于撤销）
